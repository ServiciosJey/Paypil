<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asistente Virtual - Servicios Jey</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    #chat-container { width: 100%; max-width: 400px; height: 80vh; background: #fff; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
    #chat { flex: 1; padding: 15px; overflow-y: auto; }
    .msg { margin: 8px 0; padding: 8px 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
    .user { align-self: flex-end; background: #0078d7; color: white; border-bottom-right-radius: 0; }
    .bot { align-self: flex-start; background: #e5e5ea; color: black; border-bottom-left-radius: 0; }
    #inputBox { display: flex; padding: 10px; border-top: 1px solid #ccc; }
    input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; outline: none; }
    button { margin-left: 8px; padding: 10px 16px; border: none; border-radius: 20px; background: #0078d7; color: white; cursor: pointer; }
    button:hover { background: #005fa3; }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="chat"></div>
    <div id="inputBox">
      <input type="text" id="input" placeholder="Escribe tu mensaje..." onkeydown="if(event.key==='Enter'){sendMsg()}" />
      <button onclick="sendMsg()">Enviar</button>
    </div>
  </div>

  <script>
    async function sendMsg() {
      const input = document.getElementById("input");
      const chat = document.getElementById("chat");
      const userMsg = input.value.trim();
      if (!userMsg) return;

      // Mostrar mensaje del usuario
      const userDiv = document.createElement("div");
      userDiv.className = "msg user";
      userDiv.textContent = userMsg;
      chat.appendChild(userDiv);

      input.value = "";
      chat.scrollTop = chat.scrollHeight;

      try {
        const resp = await fetch("https://prod-77.westus.logic.azure.com:443/workflows/92e0098f17414cf993f5cce07eb70ada/triggers/manual/paths/invoke?api-version=2016-06-01", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ "message": userMsg })
        });

        const data = await resp.json();

        const botDiv = document.createElement("div");
        botDiv.className = "msg bot";
        botDiv.textContent = data.reply || "(Sin respuesta)";
        chat.appendChild(botDiv);
        chat.scrollTop = chat.scrollHeight;
      } catch (error) {
        const botDiv = document.createElement("div");
        botDiv.className = "msg bot";
        botDiv.textContent = "Error al conectar con el asistente.";
        chat.appendChild(botDiv);
      }
    }
  </script>
</body>
</html>
